<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PDFExtractor JQuery sample</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>
<body>

  <form id='form' enctype="multipart/form-data">
    <p>
      <label>Copy-paste your API Key for Bytescout.IO here</label>
      <input type='text' id='apikey' placeholder='ApiKey'/>
    </p>
    <p>
      <label>InputFile</label>
      <input type="file" name='file' id='inputFile' placeholder='InputFile'>
    </p>
    <p>
      <label>Extract Type</label>
      <select id='extractType'>
        <option value="0">to XML</option>
        <option value="1">to Text</option>
        <option value="2">to CSV</option>
        <option value="3">to Info</option>
      </select>
    </p>
    <p>
      <label>Page Index (zero-based)</label>
      <input type="number" id='pageIndex' value="0">
    </p>
    <button type='button' id='submit'>Extract</button>
  </form>

  <div id='errorBlock'>
    <h2>Error:</h2>
    <h4>Code: <span id='statusCode'></span></h4>
    <ul id="errors"></ul>
  </div>

  <div id='resultBlock'>
    <h2>Result:</h2>
    <pre id='result'></pre>

  </div>

  <script>
    $(document).ready(function(){
      $('#resultBlock').hide();
      $('#errorBlock').hide();
    });

    $(document).on('click', '#submit',function(){
      $('#resultBlock').hide();
      $('#errorBlock').hide();

    var apikey = $('#apikey').val().trim(); //Get your API key by registering at http://www.bytescout.com/

    var urlUploadFile = 'https://bytescout.io/api/v1/file/upload';

    var formData = new FormData($('#form')[0]);
    var pageIndex = $('#pageIndex').val();

    $.ajax({
      url: urlUploadFile,
      type: "POST",
      data: formData,
      cache: false,
      contentType: false,
      processData: false,
      beforeSend: function(xhr){
        xhr.setRequestHeader('apikey', apikey);
      },
      success: function(fileId){
        switch($('#extractType').val()){
          case '0':
          XMLExtractor(apikey, fileId, pageIndex);
          break;          
          case '1':
          TextExtractor(apikey, fileId, pageIndex);
          break;         
          case '2':
          CSVExtractor(apikey, fileId, pageIndex);
          break;          
          case '3':
          InfoExtractor(apikey, fileId);
          break;
        }
      },
      error: function(response){
        $('#errorBlock').show();
        $('#statusCode').html(response.status);
        $('#errors').html('');
        $.each(response.responseJSON.Errors, function(){
          $('#errors').append($('<li></li>').html(this));
        })
      },
    });
  });


function XMLExtractor(apikey, fileId, pageIndex){
  var url = 'https://bytescout.io/api/v1/pdfextractor/xmlextractor/extract';

  var options = {
    "Options": {
      "StartPageIndex": pageIndex,
      "EndPageIndex": pageIndex,
      "ExtractInvisibleText": false,
    },
    "InputFileId": fileId,
  };


  $.ajax({
    url: url,
    type: 'POST',
    data: JSON.stringify(options), 
    contentType: 'application/json',
    beforeSend: function(xhr){
      xhr.setRequestHeader('apikey', apikey);
    },
    success: function(response){
      $('#resultBlock').show();
      $('#result').text(xmlToString(response));
    },
    error: function(response){
      $('#errorBlock').show();
      $('#statusCode').html(response.status);
      $('#errors').html('');
      $.each(response.responseJSON.Errors, function(){
        $('#errors').append($('<li></li>').html(this));
      })
    },
  });
}

function TextExtractor(apikey, fileId, pageIndex){
  var url = 'https://bytescout.io/api/v1/pdfextractor/textextractor/extract';

  var options = {
    "Options": {
      "StartPageIndex": pageIndex,
      "EndPageIndex": pageIndex,
      "RTLTextAutoDetectionEnabled": true,
      "DetectLinesInsteadOfParagraphs": false,
    },
    "InputFileId": fileId,
  };


  $.ajax({
    url: url,
    type: 'POST',
    data: JSON.stringify(options), 
    contentType: 'application/json',
    beforeSend: function(xhr){
      xhr.setRequestHeader('apikey', apikey);
    },
    success: function(response){
      $('#resultBlock').show();
      $('#result').html(response);
    },
    error: function(response){
      $('#errorBlock').show();
      $('#statusCode').html(response.status);
      $('#errors').html('');
      $.each(response.responseJSON.Errors, function(){
        $('#errors').append($('<li></li>').html(this));
      })
    },
  });
}

function CSVExtractor(apikey, fileId, pageIndex){
  var url = 'https://bytescout.io/api/v1/pdfextractor/csvextractor/extract';

  var options = {
    "Options": {
      "StartPageIndex": pageIndex,
      "EndPageIndex": pageIndex,
      "ColumnDetectionMode": "ContentGroups",
      "ExtractInvisibleText": false,
    },
    "InputFileId": fileId,
  };


  $.ajax({
    url: url,
    type: 'POST',
    data: JSON.stringify(options), 
    contentType: 'application/json',
    beforeSend: function(xhr){
      xhr.setRequestHeader('apikey', apikey);
    },
    success: function(response){
      $('#resultBlock').show();
      $('#result').html(response);
    },
    error: function(response){
      $('#errorBlock').show();
      $('#statusCode').html(response.status);
      $('#errors').html('');
      $.each(response.responseJSON.Errors, function(){
        $('#errors').append($('<li></li>').html(this));
      })
    },
  });
}

function InfoExtractor(apikey, fileId){
  var url = 'https://bytescout.io/api/v1/pdfextractor/infoextractor/extract';

  var options = {
    "InputFileId": fileId,
  };


  $.ajax({
    url: url,
    type: 'POST',
    data: JSON.stringify(options), 
    contentType: 'application/json',
    beforeSend: function(xhr){
      xhr.setRequestHeader('apikey', apikey);
    },
    success: function(response){
      $('#resultBlock').show();
      $('#result').html(response);
    },
    error: function(response){
      $('#errorBlock').show();
      $('#statusCode').html(response.status);
      $('#errors').html('');
      $.each(response.responseJSON.Errors, function(){
        $('#errors').append($('<li></li>').html(this));
      })
    },
  });
}


function xmlToString(xmlData) { 

  var xmlString;
    //IE
    if (window.ActiveXObject){
      xmlString = xmlData.xml;
    }
    // code for Mozilla, Firefox, Opera, etc.
    else{
      xmlString = (new XMLSerializer()).serializeToString(xmlData);
    }
    return xmlString;
  } 
</script>
</body>
</html>