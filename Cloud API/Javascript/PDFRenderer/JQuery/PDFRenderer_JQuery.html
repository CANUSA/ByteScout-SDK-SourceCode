<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PDFRenderer JQuery sample</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>
<body>

  <form id='form' enctype="multipart/form-data">
    <p>
      <label>Copy-paste your API Key for Bytescout.IO here</label>
      <input type='text' id='apikey' placeholder='ApiKey'/>
    </p>
    <p>
      <label>InputFile</label>
      <input type="file" name='file' id='inputFile' placeholder='InputFile'>
    </p>
    <p>
      <label>Ouput Image Format</label>
      <select id="rasterOutputFormat">
        <option value="BMP"> BMP  </option>
        <option value="JPEG"> JPEG  </option>
        <option value="PNG" selected="selected"> PNG  </option>
        <option value="TIFF"> TIFF  </option>
        <option value="GIF"> GIF  </option>
      </select>
    </p>
    <p>
      <label>Resolution</label>
      <input type="number" id='resolution' value="300">
    </p>  
    <p>
      <label>Page Index</label>
      <input type="number" id='pageIndex' value="0">
    </p>
    <button type='button' id='submit'>Render</button>
  </form>

  <div id='errorBlock'>
    <h2>Error:</h2>
    <h4>Code: <span id='statusCode'></span></h4>
    <ul id="errors"></ul>
  </div>

  <div id='resultBlock'>
    <h2>Result:</h2>
    <img id='result' src=""> 
  </div>

  <script>
    $(document).ready(function(){
      $('#resultBlock').hide();
      $('#errorBlock').hide();
    });

    $(document).on('click', '#submit',function(){
      $('#resultBlock').hide();
      $('#errorBlock').hide();

    var apikey = $('#apikey').val().trim(); //Get your API key by registering at http://www.bytescout.com/

    var urlUploadFile = 'https://bytescout.io/api/v1/file/upload';

    var formData = new FormData($('#form')[0]);

    $.ajax({
      url: urlUploadFile,
      type: "POST",
      data: formData,
      cache: false,
      contentType: false,
      processData: false,
      beforeSend: function(xhr){
        xhr.setRequestHeader('apikey', apikey);
      },
      success: function(fileId){
        PDFRenderer(apikey, fileId);
      },
      error: function(response){
        $('#errorBlock').show();
        $('#statusCode').html(response.status);
        $('#errors').html('');
        $.each(response.responseJSON.Errors, function(){
          $('#errors').append($('<li></li>').html(this));
        })
      },
    });
  });


    function PDFRenderer(apikey, fileId){
      var url = 'https://bytescout.io/api/v1/pdfrenderer/render';

      var options = {
        "Options": {
          "PageIndex": $('#pageIndex').val(),
          "Resolution": $('#resolution').val(),
          "JPEGQuality": 100,
          "RasterOutputFormat": $('#rasterOutputFormat').val()
        },
        "InputFileId": fileId,
        "OutputType": "link",
      };


      $.ajax({
        url: url,
        type: 'POST',
        data: JSON.stringify(options), 
        contentType: 'application/json',
        beforeSend: function(xhr){
          xhr.setRequestHeader('apikey', apikey);
        },
        success: function(link){
          $('#resultBlock').show();
          $('#result').attr('src', link);
        },
        error: function(response){
          $('#errorBlock').show();
          $('#statusCode').html(response.status);
          $('#errors').html('');
          $.each(response.responseJSON.Errors, function(){
            $('#errors').append($('<li></li>').html(this));
          })
        },
      });
    }
  </script>
</body>
</html>